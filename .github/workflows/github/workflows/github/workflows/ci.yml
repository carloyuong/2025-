name: 電子閨蜜 CI

on:  # 每次 push 或 pull request 到 main 分支都触发
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest  # GitHub 免费最快 Linux 虚拟机

    steps:
      - name: 拉取代码
        uses: actions/checkout@v4

      - name: 设置 Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: 缓存 pip 依赖（极大加速！）
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          pip install pytest  # 安装测试框架

      - name: 运行测试
        run: |
          pytest -v  # 详细输出测试结果

      # 可选：如果只想简单运行主文件而不写 pytest
      # - name: 直接运行主程序
      #   run: python 電子閨蜜.py
